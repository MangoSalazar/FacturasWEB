@page "/estadisticas"
@using FacturasWEB.Components.Servicios
@using FacturasWEB.Components.Data
@inject ServicioControlador Controlador
@rendermode InteractiveServer

<h3>Tablero de Estadísticas e Inteligencia</h3>

<h3>Inteligencia de Negocio</h3>

@if (datos == null)
{
    <div class="alert alert-info">Calculando datos...</div>
}
else
{
    <div class="row g-4">
        <div class="col-md-3">
            <div class="stat-card bg-turquesa text-center">
                <h5>Artículo Top</h5>
                <p class="fs-3 fw-bold my-2">@datos.ArticuloMasVendido</p>
                <small style="opacity: 0.9">El más vendido</small>
            </div>
        </div>

        <div class="col-md-3">
            <div class="stat-card bg-azul-oscuro text-center">
                <h5>Mes de Oro</h5>
                <p class="fs-3 fw-bold my-2">@datos.MesConMasVentas</p>
                <small style="opacity: 0.8">Mayor flujo de ventas</small>
            </div>
        </div>

        <div class="col-md-3">
            <div class="stat-card bg-azul-medio text-center">
                <h5>Cliente Frecuente</h5>
                <p class="fs-3 fw-bold my-2">@datos.ClienteMasRepetido</p>
                <small style="opacity: 0.9">Mayor recurrencia</small>
            </div>
        </div>

        <div class="col-md-3">
            <div class="stat-card bg-rosa text-center">
                <h5 style="color: var(--primary-dark)">Promedio Anual</h5>
                <p class="fs-3 fw-bold my-2" style="color: var(--primary-dark)">@datos.PromedioComprasAnuales.ToString("C")</p>
                <small style="color: var(--text-secondary)">Ticket promedio</small>
            </div>
        </div>

        <div class="col-md-6">
            <div class="mat-card h-100">
                <h5 style="border-bottom: 2px solid var(--highlight); padding-bottom: 10px;">Extremos</h5>
                <div class="d-flex justify-content-around mt-4">
                    <div class="text-center">
                        <h6 class="text-muted">Más Cara</h6>
                        <span class="fs-3 fw-bold text-success">@datos.FacturaMasCara.ToString("C")</span>
                    </div>
                    <div style="border-left: 1px solid #ccc;"></div>
                    <div class="text-center">
                        <h6 class="text-muted">Más Barata</h6>
                        <span class="fs-3 fw-bold text-secondary">@datos.FacturaMasBarata.ToString("C")</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="mat-card h-100">
                <h5 style="border-bottom: 2px solid var(--primary-light); padding-bottom: 10px;">Rendimiento Anual</h5>
                <div class="d-flex justify-content-around mt-4">
                    <div class="text-center">
                        <h6 class="text-muted">Mejor Año</h6>
                        <span class="fs-3 fw-bold" style="color: var(--primary-dark)">@datos.AnioMasVentas</span>
                    </div>
                    <div style="border-left: 1px solid #ccc;"></div>
                    <div class="text-center">
                        <h6 class="text-muted">Peor Año</h6>
                        <span class="fs-3 fw-bold text-muted">@datos.AnioMenosVentas</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private DashboardDatos datos;

    protected override async Task OnInitializedAsync()
    {
        datos = await Controlador.ObtenerDashboardEstadisticas();
    }
}