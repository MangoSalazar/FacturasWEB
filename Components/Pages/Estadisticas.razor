@page "/estadisticas"
@using FacturasWEB.Components.Servicios
@using FacturasWEB.Components.Data
@inject ServicioControlador Controlador
@rendermode InteractiveServer

<h3>Tablero de Estadísticas e Inteligencia</h3>

@if (datos == null)
{
    <div class="alert alert-info">Calculando inteligencia de negocio...</div>
}
else
{
    <div class="row g-3">
        <div class="col-md-3">
            <div class="card text-white bg-primary h-100">
                <div class="card-body">
                    <h5 class="card-title">Artículo Top</h5>
                    <p class="card-text fs-4">@datos.ArticuloMasVendido</p>
                    <small>El favorito del público</small>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-white bg-success h-100">
                <div class="card-body">
                    <h5 class="card-title">Mes de Oro</h5>
                    <p class="card-text fs-4">@datos.MesConMasVentas</p>
                    <small>Mes con mayor flujo</small>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-white bg-info h-100">
                <div class="card-body">
                    <h5 class="card-title">Cliente Frecuente</h5>
                    <p class="card-text fs-4">@datos.ClienteMasRepetido</p>
                    <small>Nombre más recurrente</small>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-dark bg-warning h-100">
                <div class="card-body">
                    <h5 class="card-title">Promedio Anual</h5>
                    <p class="card-text fs-4">@datos.PromedioComprasAnuales.ToString("C")</p>
                    <small>Ticket promedio por año</small>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100 border-danger">
                <div class="card-header bg-danger text-white">Extremos de Facturación</div>
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="text-center">
                        <h6>Factura Más Cara</h6>
                        <span class="fs-3 text-success fw-bold">@datos.FacturaMasCara.ToString("C")</span>
                    </div>
                    <div class="vr"></div>
                    <div class="text-center">
                        <h6>Factura Más Barata</h6>
                        <span class="fs-3 text-muted">@datos.FacturaMasBarata.ToString("C")</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100 border-secondary">
                <div class="card-header bg-secondary text-white">Rendimiento por Años</div>
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="text-center">
                        <h6>Mejor Año</h6>
                        <span class="fs-3 fw-bold">@datos.AnioMasVentas</span>
                    </div>
                    <div class="vr"></div>
                    <div class="text-center">
                        <h6>Año Más Bajo</h6>
                        <span class="fs-3 text-muted">@datos.AnioMenosVentas</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private DashboardDatos datos;

    protected override async Task OnInitializedAsync()
    {
        datos = await Controlador.ObtenerDashboardEstadisticas();
    }
}