@page "/Facturitas"
@using FacturasWEB.Components.Data
@using FacturasWEB.Components.Servicios
@inject ServicioControlador Controlador
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<h3>Nueva Factura</h3>

<div>
    <label>Nombre del Cliente:</label>
    <input />
</div>
<div>
    <label>Fecha:</label>
    <input type="date"  />
</div>

<hr />

<div>
    <h4>Añadir Artículo</h4>
    <div>
        <label>Artículo:</label>
        <input @bind="nuevoArticulo.Nombre" placeholder="Nombre del articulo" />
    </div>
    <div>
        <label>Precio:</label>
        <input @bind="nuevoArticulo.Precio" type="number" step="0.5" min="0.1" />
    </div>
    <div>
        <label>Cantidad:</label>
        <input @bind="nuevoArticulo.Cantidad" type="number" min="1" placeholder="1" />
    </div>
    <button @onclick="agregarArticulo">Añadir ese articulo</button>
</div>

<hr />

<h4>Artículos de la Factura</h4>

<ol>
    @foreach (var art in articulos)
    {
        <li>
            <span>@art.Nombre</span> |
            <span>Precio: @art.Precio</span> |
            <span>Cantidad: @art.Cantidad</span> |
            <span>Subtotal: @(art.Precio * art.Cantidad)</span>
            <button @onclick="() => eliminarArticulo(art)">Eliminar</button>
        </li>
    }
</ol>

<div>
    <h4>Total: @total </h4>
    
</div>

<hr />

<div>
    <button>Guardar la factura</button>
</div>
@code {
    private Articulo nuevoArticulo = new Articulo();
    private List<Articulo> articulos = new List<Articulo>();
    private double total = 0.0;
    protected override async Task OnInitializedAsync()
    {
        articulos = await Controlador.obtenerArticulos();
    }

    private async Task eliminarArticulo(Articulo articulo)
    {
        Controlador.eliminarArticulo(articulo);
        articulos = await Controlador.obtenerArticulos();
		total -= articulo.Precio * articulo.Cantidad;
    }

    private async Task agregarArticulo()
    {
        if (!string.IsNullOrWhiteSpace(nuevoArticulo.Nombre) &&
        nuevoArticulo.Precio > 0 &&
        nuevoArticulo.Cantidad > 0)
        {
            Controlador.agregarArticulo(nuevoArticulo);
            articulos = await Controlador.obtenerArticulos();
            total += nuevoArticulo.Precio * nuevoArticulo.Cantidad;
        }
    }
}