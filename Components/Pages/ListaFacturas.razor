@page "/lista-facturas"
@using FacturasWEB.Components.Data
@using FacturasWEB.Components.Servicios
@inject ServicioControlador Controlador
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<h3>Lista de Facturas</h3>

@if (facturasCargadas == null)
{
    <p>Cargando facturas...</p>
}
else if (!facturasCargadas.Any())
{
    <p>No hay facturas guardadas en la base de datos.</p>
}
else
{
    <table border="1">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Nombre Cliente</th>
                <th>Cantidad de Artículos</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var factura in facturasCargadas)
            {
                <tr>
                    <td>@factura.Fecha</td>
                    <td>@factura.Nombre</td>
                    <td>@factura.Articulos.Count()</td>
                    <td>
                        <button @onclick="() => Editar(factura.ID_facturas)">Editar</button>
                        <button @onclick="() => Eliminar(factura.ID_facturas)">Eliminar</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

@code {

    private List<Factura> facturasCargadas;

    // Cuando la página carga, llama al controlador
    protected override async Task OnInitializedAsync()
    {
        facturasCargadas = await Controlador.obtenerFacturas();
    }

    // Métodos para los botones (por ahora solo imprimen en la consola)

    private void Editar(int idFactura)
    {
        Console.WriteLine($"Editar factura ID: {idFactura}");
        // Aquí podrías navegar a la otra página
        // NavigationManager.NavigateTo($"/Facturitas/{idFactura}"); // (Si la modificas para editar)
    }

    private async Task Eliminar(int idFactura)
    {
        Console.WriteLine($"Eliminar factura ID: {idFactura}");

        // --- Lógica futura ---
        // 1. Llamar a: await Controlador.EliminarFactura(idFactura);
        // 2. Recargar la lista: facturasCargadas = await Controlador.obtenerFacturas();
        // 3. Notificar a la UI: StateHasChanged();
    }
}
